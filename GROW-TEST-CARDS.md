# 💳 כרטיסי אשראי לטסט - Grow/Meshulam

## 🎯 סביבת Sandbox

לפני שעושים טסטים, צריך להגדיר את סביבת ה-Sandbox של Grow.

---

## 🔧 הגדרת Sandbox

### **1. משתני סביבה:**

עדכן את `.env.local`:

```env
# Grow/Meshulam Sandbox (טסט)
GROW_API_KEY=test_your_api_key_here
GROW_USER_ID=test_user_id
GROW_PAGE_CODE=test_page_code
GROW_BASE_URL=https://sandbox.meshulam.co.il  # ← Sandbox URL
NEXT_PUBLIC_BASE_URL=http://localhost:3001

# או בפרודקשן:
# GROW_BASE_URL=https://secure.meshulam.co.il
```

### **2. קבלת API Keys לטסט:**

1. היכנס לפורטל Grow: https://grow.business/
2. לך ל: הגדרות → API Keys
3. בחר: "Sandbox Environment"
4. העתק את ה-API Keys

---

## 💳 כרטיסי אשראי לטסט

### **✅ כרטיסים שעוברים (Success):**

```
ויזה (Visa):
מספר: 4580 4580 4580 4580
תוקף: 12/25 (כל תאריך עתידי)
CVV: 123
שם: TEST CARD

מאסטרקארד (MasterCard):
מספר: 5326 1234 5678 9010
תוקף: 12/25
CVV: 123
שם: TEST CARD

ישראכרט:
מספר: 3742 0000 0000 004
תוקף: 12/25
CVV: 1234
שם: TEST CARD
```

---

### **❌ כרטיסים שנכשלים (Failed):**

```
כרטיס לא תקין:
מספר: 4580 0000 0000 0000
תוקף: 12/25
CVV: 123
→ יחזיר: "כרטיס לא תקין"

יתרה לא מספיקה:
מספר: 4580 1111 1111 1111
תוקף: 12/25
CVV: 123
→ יחזיר: "יתרה לא מספיקה"

כרטיס חסום:
מספר: 4580 2222 2222 2222
תוקף: 12/25
CVV: 123
→ יחזיר: "כרטיס חסום"
```

---

### **⏳ כרטיסים שדורשים אישור (Pending):**

```
דורש אישור נוסף:
מספר: 4580 3333 3333 3333
תוקף: 12/25
CVV: 123
→ יחזיר: "דורש אישור מהבנק"
```

---

### **💰 כרטיסים לתשלומים:**

```
תשלומים 12 פעמים:
מספר: 4580 4580 4580 4580
תוקף: 12/25
CVV: 123
תשלומים: 12
→ יעבור בהצלחה

תשלומים 36 פעמים (נכשל):
מספר: 4580 5555 5555 5555
תוקף: 12/25
CVV: 123
תשלומים: 36
→ יחזיר: "מספר תשלומים לא נתמך"
```

---

## 🔄 כרטיסים למנויים חוזרים (Recurring):

```
מנוי חודשי מצליח:
מספר: 4580 4580 4580 4580
תוקף: 12/25
CVV: 123
→ התשלום הראשון יעבור
→ החיובים החודשיים יצליחו

מנוי שיכשל בחיוב השני:
מספר: 4580 6666 6666 6666
תוקף: 12/25
CVV: 123
→ התשלום הראשון יעבור
→ החיוב השני יכשל
```

---

## 🧪 תרחישי טסט

### **1. תשלום חד-פעמי מצליח:**
```
1. כנס ל: /admin/customers/[id]
2. צור חשבונית עם פריטים
3. פתח את הלינק
4. הכנס כרטיס: 4580 4580 4580 4580
5. תוקף: 12/25, CVV: 123
6. שלם
7. ✅ אמור לראות "תשלום הושלם"
```

### **2. תשלום שנכשל:**
```
1. צור חשבונית
2. פתח לינק
3. הכנס כרטיס: 4580 0000 0000 0000
4. ❌ יחזיר: "כרטיס לא תקין"
```

### **3. מנוי חודשי:**
```
1. כנס ל: /admin/customers/[id]
2. לחץ "הפעל חיוב אוטומטי"
3. פתח לינק תשלום
4. הכנס כרטיס: 4580 4580 4580 4580
5. שלם
6. ✅ מנוי יוצר
7. המתן 30 יום (או שנה את התאריך ב-DB)
8. Grow יחייב אוטומטית
```

### **4. בדיקת Webhook:**
```
1. צור מנוי/תשלום
2. שלם בכרטיס טסט
3. בדוק ב-terminal של השרת:
   🔔 Grow Webhook received
   📦 Webhook payload: {...}
   ✅ Payment updated successfully
```

---

## 🎭 דמוי עסקאות שונות:

### **סכומים שונים:**
```
סכום קטן (₪10):
→ יעבור בהצלחה

סכום גדול (₪10,000):
→ יעבור בהצלחה (בסנדבוקס)

סכום מאוד גדול (₪100,000):
→ עלול להיכשל (תלוי בהגדרות הסנדבוקס)
```

### **תשלומים:**
```
תשלום אחד:
→ יעבור

3 תשלומים:
→ יעבור

12 תשלומים:
→ יעבור

36 תשלומים:
→ נכשל (בדרך כלל לא נתמך)
```

---

## 🔍 בדיקת סטטוס בפורטל Grow:

1. היכנס לפורטל Grow
2. לך ל: תשלומים → Sandbox
3. תראה את כל העסקאות הדמומיות
4. סטטוס, סכום, תאריך, וכו'

---

## 🚀 איך לעבור לפרודקשן:

### **1. החלף API Keys:**
```env
# מ-Sandbox
GROW_API_KEY=test_xxxxx
GROW_BASE_URL=https://sandbox.meshulam.co.il

# לפרודקשן
GROW_API_KEY=live_xxxxx
GROW_BASE_URL=https://secure.meshulam.co.il
```

### **2. בדוק SSL:**
```
וודא ש-Webhook URL הוא HTTPS:
https://yourdomain.com/api/webhooks/grow
```

### **3. הפעל מחדש:**
```bash
npm run build
npm start
```

---

## 💡 טיפים:

1. **השתמש רק בכרטיסי טסט בסנדבוקס!**
2. **אל תשתמש בכרטיסים אמיתיים בפיתוח**
3. **בדוק את כל התרחישים לפני פרודקשן**
4. **שמור לוגים של הטסטים**

---

## 📧 פנייה לתמיכה:

אם יש בעיות:
- support@grow.business
- 03-9999999
- פורטל התמיכה: https://support.grow.business

---

## 🎉 זהו! עכשיו אפשר לעשות טסטים!

```bash
# הרץ את השרת
npm run dev

# צור לקוח חדש
# הפעל מנוי
# שלם בכרטיס טסט
# בדוק ש-Webhook עובד

✅ הכל עובד!
```
